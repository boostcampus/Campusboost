<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Timetable Generator</title>
    <style>
        :root {
            --primary-color: #3B82F6;
            --accent-color: #9333EA;
            --background-color: #F9FAFB;
            --text-dark: #1F2937;
            --text-muted: #6B7280;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: var(--background-color);
            color: var(--text-dark);
            margin: 0;
            padding: 2rem;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .container {
            max-width: 1200px;
            width: 100%;
            background-color: #fff;
            padding: 2rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            display: grid;
            grid-template-columns: 1fr 3fr;
            gap: 2rem;
        }

        h1 {
            grid-column: 1 / -1;
            color: var(--primary-color);
            text-align: center;
            margin-bottom: 2rem;
        }

        h2 {
            color: var(--text-dark);
            border-bottom: 2px solid var(--accent-color);
            padding-bottom: 0.5rem;
            margin-top: 0;
            margin-bottom: 1rem;
        }

        .controls {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }
        
        .form-group {
            margin-bottom: 1rem;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text-dark);
            font-weight: 600;
        }

        input[type="text"], input[type="number"], select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #E5E7EB;
            border-radius: 0.375rem;
            font-size: 1rem;
            box-sizing: border-box;
            color: var(--text-dark);
            background-color: #fff;
            transition: border-color 0.2s ease-in-out;
        }

        input[type="text"]:focus, input[type="number"]:focus, select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
        }

        button {
            padding: 0.75rem 1.5rem;
            font-size: 1rem;
            font-weight: 600;
            border: none;
            border-radius: 0.375rem;
            cursor: pointer;
            transition: background-color 0.2s ease-in-out;
            margin-top: 1rem;
        }

        .primary-btn {
            background-color: var(--primary-color);
            color: #fff;
        }

        .primary-btn:hover {
            background-color: #2563EB;
        }
        
        .accent-btn {
            background-color: var(--accent-color);
            color: #fff;
        }

        .accent-btn:hover {
            background-color: #7E22CE;
        }
        
        .remove-btn {
            background-color: #EF4444;
            color: #fff;
            padding: 0.25rem 0.5rem;
            margin-left: 0.5rem;
            margin-top: 0;
            font-size: 0.875rem;
        }
        
        .remove-btn:hover {
            background-color: #DC2626;
        }

        #subject-list {
            list-style-type: none;
            padding: 0;
        }

        .subject-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem;
            border-bottom: 1px solid #E5E7EB;
        }
        
        #timetable-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 1px;
            border: 1px solid #E5E7EB;
            background-color: #E5E7EB;
        }
        
        .grid-cell {
            background-color: #fff;
            padding: 1rem 0.5rem;
            text-align: center;
            border: 1px solid #E5E7EB;
            min-height: 50px;
            cursor: pointer;
            position: relative;
        }
        
        .grid-header {
            background-color: var(--primary-color);
            color: #fff;
            font-weight: 600;
            padding: 0.75rem 0.5rem;
        }
        
        .grid-cell.time {
            background-color: #F3F4F6;
            color: var(--text-dark);
            font-weight: 600;
        }
        
        .subject-slot {
            background-color: var(--accent-color);
            color: #fff;
            padding: 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.875rem;
            display: block;
            position: relative;
        }

        .subject-slot:hover .remove-subject-slot {
            display: block;
        }

        .remove-subject-slot {
            position: absolute;
            top: 2px;
            right: 2px;
            background-color: #EF4444;
            color: #fff;
            border: none;
            padding: 0.25rem;
            border-radius: 50%;
            cursor: pointer;
            line-height: 1;
            font-size: 0.7rem;
            font-weight: bold;
            display: none;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>Advanced Timetable Generator üóìÔ∏è</h1>

        <div class="controls">
            <div class="subject-controls">
                <h2>Manage Subjects</h2>
                <div class="form-group">
                    <label for="subject-name">Subject Name:</label>
                    <input type="text" id="subject-name" placeholder="e.g., Mathematics">
                </div>
                <div class="form-group">
                    <label for="subject-color">Color:</label>
                    <input type="color" id="subject-color" value="#9333EA">
                </div>
                <button class="primary-btn" onclick="addSubject()">Add Subject</button>
                <ul id="subject-list"></ul>
            </div>
            
            <div class="pdf-controls">
                <h2>PDF Settings</h2>
                <div class="form-group">
                    <label for="timetable-title">Timetable Title:</label>
                    <input type="text" id="timetable-title" placeholder="e.g., Weekly Schedule">
                </div>
                <button class="accent-btn" onclick="generatePdf()">Generate PDF</button>
            </div>
        </div>

        <div class="timetable">
            <h2>Timetable Grid</h2>
            <div id="timetable-grid">
                </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <script>
        const days = ["Time", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday"];
        const times = ["9:00 AM", "10:00 AM", "11:00 AM", "12:00 PM", "1:00 PM", "2:00 PM", "3:00 PM", "4:00 PM"];
        let subjects = [];

        document.addEventListener('DOMContentLoaded', () => {
            generateGrid();
            document.getElementById('timetable-title').value = "My Weekly Timetable";
        });

        function generateGrid() {
            const grid = document.getElementById('timetable-grid');
            grid.innerHTML = '';
            
            // Generate headers
            days.forEach(day => {
                const header = document.createElement('div');
                header.className = 'grid-cell grid-header';
                header.textContent = day;
                grid.appendChild(header);
            });

            // Generate cells
            for (let i = 0; i < times.length; i++) {
                const timeCell = document.createElement('div');
                timeCell.className = 'grid-cell time';
                timeCell.textContent = times[i];
                grid.appendChild(timeCell);
                
                for (let j = 1; j < days.length; j++) {
                    const cell = document.createElement('div');
                    cell.className = 'grid-cell';
                    cell.setAttribute('data-day', days[j]);
                    cell.setAttribute('data-time', times[i]);
                    cell.addEventListener('click', handleCellClick);
                    grid.appendChild(cell);
                }
            }
        }

        function addSubject() {
            const nameInput = document.getElementById('subject-name');
            const colorInput = document.getElementById('subject-color');
            const name = nameInput.value.trim();
            const color = colorInput.value;

            if (name) {
                const newSubject = { id: Date.now(), name: name, color: color };
                subjects.push(newSubject);
                renderSubjects();
                nameInput.value = '';
            }
        }

        function renderSubjects() {
            const list = document.getElementById('subject-list');
            list.innerHTML = '';
            subjects.forEach(subject => {
                const listItem = document.createElement('li');
                listItem.className = 'subject-item';
                listItem.innerHTML = `
                    <span style="color: ${subject.color}; font-weight: bold;">${subject.name}</span>
                    <button class="remove-btn" onclick="removeSubject(${subject.id})">X</button>
                `;
                listItem.setAttribute('data-id', subject.id);
                list.appendChild(listItem);
            });
        }

        function removeSubject(id) {
            subjects = subjects.filter(sub => sub.id !== id);
            renderSubjects();
        }

        let selectedSubjectId = null;
        document.getElementById('subject-list').addEventListener('click', (event) => {
            const subjectItem = event.target.closest('.subject-item');
            if (subjectItem) {
                document.querySelectorAll('.subject-item').forEach(item => {
                    item.style.border = 'none';
                });
                subjectItem.style.border = '2px solid var(--primary-color)';
                selectedSubjectId = parseInt(subjectItem.getAttribute('data-id'));
            }
        });

        function handleCellClick(event) {
            if (!selectedSubjectId) {
                alert("Please select a subject first.");
                return;
            }
            
            const cell = event.target.closest('.grid-cell');
            if (!cell || cell.classList.contains('time') || cell.classList.contains('grid-header')) {
                return;
            }

            const existingSlot = cell.querySelector('.subject-slot');
            if (existingSlot) {
                 if (confirm("This slot is already filled. Do you want to replace it?")) {
                    cell.innerHTML = '';
                 } else {
                     return;
                 }
            }

            const subject = subjects.find(sub => sub.id === selectedSubjectId);
            if (subject) {
                const subjectSlot = document.createElement('div');
                subjectSlot.className = 'subject-slot';
                subjectSlot.textContent = subject.name;
                subjectSlot.style.backgroundColor = subject.color;
                
                const removeBtn = document.createElement('button');
                removeBtn.className = 'remove-subject-slot';
                removeBtn.textContent = 'x';
                removeBtn.onclick = (e) => {
                    e.stopPropagation();
                    cell.innerHTML = '';
                };
                subjectSlot.appendChild(removeBtn);
                
                cell.appendChild(subjectSlot);
            }
        }

        async function generatePdf() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF({ orientation: 'landscape' });
            
            const title = document.getElementById('timetable-title').value || 'Weekly Timetable';
            doc.setFontSize(22);
            doc.setTextColor(59, 130, 246);
            doc.text(title, doc.internal.pageSize.width / 2, 20, { align: 'center' });

            const tableRows = [];
            const timetableGrid = document.getElementById('timetable-grid');

            // Find subject cells
            const subjectCells = timetableGrid.querySelectorAll('.grid-cell:not(.time):not(.grid-header)');
            const dataMatrix = [];

            // Initialize data matrix with empty strings
            times.forEach(() => {
                dataMatrix.push(Array(days.length - 1).fill(''));
            });

            subjectCells.forEach(cell => {
                const day = cell.getAttribute('data-day');
                const time = cell.getAttribute('data-time');
                const subjectSlot = cell.querySelector('.subject-slot');
                
                if (subjectSlot) {
                    const subjectName = subjectSlot.textContent.replace('x', '').trim();
                    const dayIndex = days.indexOf(day) - 1;
                    const timeIndex = times.indexOf(time);
                    if (dayIndex >= 0 && timeIndex >= 0) {
                        dataMatrix[timeIndex][dayIndex] = subjectName;
                    }
                }
            });
            
            // Build the table rows with time headers
            for (let i = 0; i < times.length; i++) {
                tableRows.push([times[i], ...dataMatrix[i]]);
            }

            doc.autoTable({
                startY: 30,
                head: [days],
                body: tableRows,
                theme: 'grid',
                styles: {
                    font: 'helvetica',
                    textColor: [31, 41, 55],
                    fontSize: 10,
                    cellPadding: 4
                },
                headStyles: {
                    fillColor: [59, 130, 246],
                    textColor: [255, 255, 255],
                    fontStyle: 'bold'
                },
                bodyStyles: {
                    fillColor: [255, 255, 255]
                },
                alternateRowStyles: {
                    fillColor: [249, 250, 251]
                }
            });

            doc.save(`${title.replace(/ /g, '_')}.pdf`);
        }
    </script>
</body>
</html>